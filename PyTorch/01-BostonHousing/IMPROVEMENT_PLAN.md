# Boston Housing価格予測プロジェクト - プロフェッショナル化改善計画書

## 📋 目次
1. [改善の目的](#改善の目的)
2. [現状分析](#現状分析)
3. [改善項目の詳細](#改善項目の詳細)
4. [新しいプロジェクト構成](#新しいプロジェクト構成)
5. [技術スタック](#技術スタック)
6. [実装計画](#実装計画)
7. [期待される成果](#期待される成果)

---

## 🎯 改善の目的

本プロジェクトを**学習用のサンプルコード**から**実務レベルのポートフォリオプロジェクト**に昇華させることを目的とします。

### ターゲット
- 採用担当者への技術力アピール
- クライアントへの実装能力の証明
- 実務で使える機械学習プロジェクトのテンプレート化

### 達成目標
- ✅ 産業界のベストプラクティスに準拠したコード構造
- ✅ 再現性の高い実験管理
- ✅ 包括的な評価とレポート生成
- ✅ インタラクティブなデモアプリケーション
- ✅ プロフェッショナルなドキュメンテーション

---

## 🔍 現状分析

### 現在の強み
- ✅ 基本的なPyTorchワークフローを実装済み
- ✅ モデルの保存・読み込み機能あり
- ✅ 訓練と推論のスクリプトを分離

### 改善が必要な点

| 項目 | 現状 | 問題点 |
|------|------|--------|
| **データ処理** | 生データをそのまま使用 | 正規化なし、データ分割が不適切（テスト10件のみ） |
| **モデル** | 単一の固定モデル | アーキテクチャの比較なし、過学習対策なし |
| **評価** | テストlossのみ | 詳細な評価指標なし、可視化なし |
| **コード構造** | スクリプトベース | モジュール化されていない、再利用性が低い |
| **実験管理** | なし | ハイパーパラメータの追跡なし、再現性が低い |
| **ドキュメント** | 基本的なREADME | 詳細な解説やAPIドキュメントなし |
| **デモ** | なし | 実際の動作を見せられない |

---

## 🚀 改善項目の詳細

### 1. データ処理パイプラインの構築

#### 1.1 データ前処理クラス (`src/data/preprocessing.py`)
```python
機能:
- StandardScaler: 特徴量の標準化 (平均0、標準偏差1)
- MinMaxScaler: 特徴量の正規化 (0-1範囲)
- データ分割: 訓練70% / 検証15% / テスト15%
- 外れ値検出と処理
- 欠損値処理（今回のデータにはないが実装）
```

#### 1.2 PyTorch Datasetクラス (`src/data/dataset.py`)
```python
機能:
- カスタムDatasetクラス（HousingDataset）
- DataLoaderによるバッチ処理
- データ拡張の準備（将来的な拡張用）
```

#### 1.3 データ分析ノートブック (`notebooks/01_data_exploration.ipynb`)
```python
内容:
- データの統計量可視化
- 特徴量間の相関分析（ヒートマップ）
- 分布の確認（ヒストグラム）
- 外れ値の検出（箱ひげ図）
- ターゲット変数の分析
```

---

### 2. モデルアーキテクチャの拡張

#### 2.1 複数のモデル実装 (`src/models/`)

**BaselineModel** (`baseline.py`)
- 単純な線形回帰（比較用ベースライン）
- 構造: 13 → 1

**SimpleNN** (`simple_nn.py`)
- 現在のモデルを改良
- 構造: 13 → 100 → 1
- Dropout層追加（過学習防止）

**DeepNN** (`deep_nn.py`)
- より深いネットワーク
- 構造: 13 → 128 → 64 → 32 → 1
- Batch Normalization追加
- Dropout層追加
- 活性化関数: ReLU / LeakyReLU

**ResidualNN** (`residual_nn.py`)
- 残差接続を持つネットワーク
- スキップコネクション実装

#### 2.2 モデル基底クラス (`src/models/base_model.py`)
```python
機能:
- 全モデル共通のインターフェース
- パラメータ数のカウント
- モデルサマリーの出力
- 重みの初期化戦略
```

---

### 3. 訓練システムの高度化

#### 3.1 Trainerクラス (`src/training/trainer.py`)

```python
機能:
- エポックごとの訓練ループ
- 訓練loss / 検証lossの記録
- Early Stopping実装
  - 検証lossが改善しない場合に訓練を停止
  - patienceパラメータで調整可能
- Model Checkpoint
  - ベストモデルの自動保存
  - エポックごとのチェックポイント保存オプション
- 学習率スケジューリング
  - ReduceLROnPlateau: 検証lossが停滞時に学習率を下げる
  - StepLR: 一定エポックごとに学習率を下げる
- 訓練履歴のJSON保存
- プログレスバー表示（tqdm使用）
```

#### 3.2 設定管理 (`config/config.yaml`)

```yaml
内容:
- データパス
- モデルのハイパーパラメータ
  - 隠れ層のユニット数
  - Dropout率
  - Batch Normalizationの有無
- 訓練パラメータ
  - バッチサイズ
  - エポック数
  - 学習率
  - オプティマイザ（Adam, SGD, AdamWなど）
- Early Stoppingパラメータ
- ロギング設定
- 乱数シード（再現性確保）
```

#### 3.3 実験管理 (`src/training/experiment.py`)

```python
機能:
- 実験IDの自動生成（タイムスタンプベース）
- 実験ごとのディレクトリ作成
- ハイパーパラメータのログ保存
- 複数の設定での自動実験実行
- 結果の一元管理
```

---

### 4. 評価システムの構築

#### 4.1 評価クラス (`src/evaluation/evaluator.py`)

```python
実装する評価指標:
- MSE (Mean Squared Error): 平均二乗誤差
- RMSE (Root Mean Squared Error): 二乗平均平方根誤差
- MAE (Mean Absolute Error): 平均絶対誤差
- R² Score: 決定係数（モデルの説明力）
- MAPE (Mean Absolute Percentage Error): 平均絶対誤差率
- 最大誤差 / 最小誤差
```

#### 4.2 可視化モジュール (`src/visualization/`)

**学習曲線** (`learning_curves.py`)
```python
- 訓練loss vs 検証loss のプロット
- エポックごとの推移
- Early Stoppingポイントの表示
- 複数モデルの比較プロット
```

**予測性能** (`prediction_plots.py`)
```python
- 予測値 vs 実測値の散布図
  - 完全予測ライン（y=x）との比較
  - 信頼区間の表示
- 残差プロット
  - 残差の分布（ヒストグラム）
  - 残差 vs 予測値（等分散性の確認）
  - QQプロット（正規性の確認）
- 誤差分布のヒストグラム
```

**特徴量分析** (`feature_analysis.py`)
```python
- 特徴量重要度の可視化
  - 重み行列の分析
  - SHAP値による解釈（オプション）
- 特徴量と予測誤差の関係
- 相関マトリックス
```

**レポート生成** (`report_generator.py`)
```python
- HTMLレポートの自動生成
- PDFエクスポート機能
- 全ての図表を含む包括的なレポート
```

---

### 5. コード品質とプロジェクト構造

#### 5.1 モジュール構造

```
01-BostonHousing/
├── config/
│   ├── config.yaml              # デフォルト設定
│   └── experiments/             # 実験ごとの設定
│       ├── baseline.yaml
│       ├── simple_nn.yaml
│       └── deep_nn.yaml
│
├── data/
│   ├── raw/                     # 生データ
│   │   └── housing.data
│   └── processed/               # 前処理済みデータ
│       └── preprocessed.npz
│
├── src/
│   ├── __init__.py
│   ├── data/
│   │   ├── __init__.py
│   │   ├── preprocessing.py     # データ前処理
│   │   └── dataset.py           # PyTorch Dataset
│   │
│   ├── models/
│   │   ├── __init__.py
│   │   ├── base_model.py        # 基底クラス
│   │   ├── baseline.py          # 線形回帰
│   │   ├── simple_nn.py         # シンプルNN
│   │   ├── deep_nn.py           # 深層NN
│   │   └── residual_nn.py       # 残差NN
│   │
│   ├── training/
│   │   ├── __init__.py
│   │   ├── trainer.py           # 訓練クラス
│   │   └── experiment.py        # 実験管理
│   │
│   ├── evaluation/
│   │   ├── __init__.py
│   │   └── evaluator.py         # 評価クラス
│   │
│   ├── visualization/
│   │   ├── __init__.py
│   │   ├── learning_curves.py   # 学習曲線
│   │   ├── prediction_plots.py  # 予測可視化
│   │   ├── feature_analysis.py  # 特徴量分析
│   │   └── report_generator.py  # レポート生成
│   │
│   └── utils/
│       ├── __init__.py
│       ├── config_loader.py     # 設定読み込み
│       ├── logger.py            # ロギング
│       └── seed.py              # 乱数シード固定
│
├── notebooks/
│   ├── 01_data_exploration.ipynb      # データ探索
│   ├── 02_model_comparison.ipynb      # モデル比較
│   └── 03_results_analysis.ipynb      # 結果分析
│
├── scripts/
│   ├── train.py                 # 訓練スクリプト
│   ├── evaluate.py              # 評価スクリプト
│   ├── inference.py             # 推論スクリプト
│   └── run_experiments.py       # 複数実験の実行
│
├── experiments/                 # 実験結果
│   └── {experiment_id}/
│       ├── config.yaml          # 使用した設定
│       ├── model_best.pth       # ベストモデル
│       ├── training_history.json # 訓練履歴
│       ├── metrics.json         # 評価指標
│       ├── plots/               # 図表
│       └── report.html          # レポート
│
├── app/
│   ├── streamlit_app.py         # Streamlitデモアプリ
│   └── gradio_app.py            # Gradioデモアプリ
│
├── tests/                       # ユニットテスト
│   ├── test_data.py
│   ├── test_models.py
│   └── test_training.py
│
├── docs/                        # ドキュメント
│   ├── API_REFERENCE.md         # API リファレンス
│   ├── TUTORIAL.md              # チュートリアル
│   └── ARCHITECTURE.md          # アーキテクチャ説明
│
├── requirements.txt             # 依存関係
├── setup.py                     # パッケージ設定
├── README.md                    # プロジェクト概要
├── IMPROVEMENT_PLAN.md          # 本ドキュメント
└── .gitignore                   # Git除外設定
```

#### 5.2 コーディング規約

- **型ヒント**: 全ての関数にtype hintsを追加
- **Docstring**: Google形式のdocstringを全関数に記述
- **Logging**: print文の代わりにloggingモジュール使用
- **エラーハンドリング**: 適切な例外処理
- **命名規則**: PEP8準拠
- **コメント**: 複雑なロジックに日本語コメント

---

### 6. デモアプリケーション

#### 6.1 Streamlitアプリ (`app/streamlit_app.py`)

```python
機能:
- サイドバーで特徴量を入力（スライダー/数値入力）
- リアルタイムで価格予測を表示
- モデルの選択（ドロップダウン）
- 予測の信頼区間表示
- 入力値の可視化（レーダーチャート）
- 類似物件の表示
- モデル性能の概要表示
```

#### 6.2 Gradioアプリ (`app/gradio_app.py`)

```python
機能:
- タブ形式のインターフェース
  - Tab1: 単一予測
  - Tab2: バッチ予測（CSVアップロード）
  - Tab3: モデル比較
- サンプルデータの提供
- 予測結果のダウンロード
```

---

### 7. テストとCI/CD

#### 7.1 ユニットテスト (`tests/`)

```python
テスト項目:
- データ前処理の正確性
- モデルの入出力形状
- 訓練ループの動作
- 評価指標の計算
- 設定ファイルの読み込み
```

#### 7.2 CI/CD（オプション）

```yaml
GitHub Actions:
- pytest実行
- コードスタイルチェック（flake8, black）
- 型チェック（mypy）
- ドキュメント生成
```

---

## 🛠️ 技術スタック

### コア技術
| カテゴリ | ライブラリ/技術 | バージョン | 用途 |
|----------|----------------|------------|------|
| **深層学習** | PyTorch | 2.0+ | モデル構築・訓練 |
| **数値計算** | NumPy | 1.24+ | データ処理 |
| **データ処理** | pandas | 2.0+ | データ操作 |
| **可視化** | Matplotlib | 3.7+ | グラフ作成 |
| **可視化** | Seaborn | 0.12+ | 統計グラフ |
| **可視化** | Plotly | 5.14+ | インタラクティブグラフ |

### 実験管理・評価
| カテゴリ | ライブラリ | 用途 |
|----------|------------|------|
| **評価指標** | scikit-learn | 各種メトリクス計算 |
| **プログレスバー** | tqdm | 訓練進捗表示 |
| **設定管理** | PyYAML | YAML設定読み込み |
| **ロギング** | logging（標準ライブラリ） | ログ管理 |

### デモアプリ
| カテゴリ | ライブラリ | 用途 |
|----------|------------|------|
| **Webアプリ** | Streamlit | インタラクティブデモ |
| **Webアプリ** | Gradio | 簡易デモUI |

### 開発ツール
| カテゴリ | ライブラリ | 用途 |
|----------|------------|------|
| **テスト** | pytest | ユニットテスト |
| **コードフォーマット** | black | コード整形 |
| **リンター** | flake8 | コード品質チェック |
| **型チェック** | mypy | 型検証 |

### ドキュメント
| カテゴリ | ライブラリ | 用途 |
|----------|------------|------|
| **ノートブック** | Jupyter | データ分析 |
| **レポート** | WeasyPrint | PDF生成 |

---

## 📅 実装計画

### Phase 1: 基盤構築（優先度: 高）

**1週目**
- [x] プロジェクト構造のリファクタリング
- [ ] データ処理パイプラインの実装
  - `src/data/preprocessing.py`
  - `src/data/dataset.py`
- [ ] 基底モデルクラスの実装
- [ ] 設定管理システムの構築
- [ ] ロギングシステムの構築

**成果物:**
- モジュール化されたコードベース
- 設定ファイルによる管理
- 再現性のあるデータ分割

---

### Phase 2: モデルと訓練システム（優先度: 高）

**2週目**
- [ ] 複数モデルの実装
  - Baseline, SimpleNN, DeepNN
- [ ] Trainerクラスの実装
  - Early Stopping
  - Model Checkpoint
  - 学習率スケジューリング
- [ ] 実験管理システムの実装

**成果物:**
- 複数のモデルアーキテクチャ
- 自動化された訓練パイプライン
- 実験結果の体系的な管理

---

### Phase 3: 評価と可視化（優先度: 高）

**3週目**
- [ ] 評価システムの実装
  - 各種メトリクスの計算
- [ ] 可視化モジュールの実装
  - 学習曲線
  - 予測プロット
  - 残差分析
  - 特徴量分析
- [ ] レポート自動生成機能

**成果物:**
- 包括的な評価指標
- プロフェッショナルな可視化
- 自動生成されるHTMLレポート

---

### Phase 4: デモアプリとドキュメント（優先度: 中）

**4週目**
- [ ] Streamlitアプリの開発
- [ ] データ探索ノートブックの作成
- [ ] APIドキュメントの作成
- [ ] チュートリアルの作成

**成果物:**
- インタラクティブなデモアプリ
- 充実したドキュメント
- 使いやすいチュートリアル

---

### Phase 5: 品質向上と最終調整（優先度: 中）

**5週目**
- [ ] ユニットテストの作成
- [ ] コードレビューと最適化
- [ ] ドキュメントの最終調整
- [ ] READMEの更新

**成果物:**
- テストカバレッジ80%以上
- リファクタリングされた高品質コード
- 完全なドキュメント

---

## 🎯 期待される成果

### 技術的成果

#### 1. モデル性能の向上
| 指標 | 現状（推定） | 目標 |
|------|-------------|------|
| R² Score | 0.65-0.75 | 0.85+ |
| RMSE | 5.0-6.0 | 3.5以下 |
| MAE | 3.5-4.5 | 2.5以下 |

#### 2. コード品質
- ✅ モジュール化率: 100%
- ✅ Type hints カバレッジ: 90%+
- ✅ Docstring カバレッジ: 100%
- ✅ テストカバレッジ: 80%+
- ✅ PEP8準拠率: 100%

#### 3. 再現性
- ✅ 乱数シード固定による完全な再現性
- ✅ 環境の明確な定義（requirements.txt）
- ✅ 実験設定の完全な記録

---

### ビジネス価値

#### ポートフォリオとしての強み

**技術力の証明**
- ✅ 実務レベルのコード品質
- ✅ MLOpsのベストプラクティス適用
- ✅ エンドツーエンドのプロジェクト経験

**実装スキルの提示**
- ✅ PyTorchの深い理解
- ✅ ソフトウェアエンジニアリング能力
- ✅ データサイエンスの総合力

**プレゼンテーション能力**
- ✅ デモアプリによる即座の体験提供
- ✅ 包括的なドキュメント
- ✅ 視覚的に魅力的なレポート

---

### 学習成果

このプロジェクトを通じて習得できるスキル：

1. **データサイエンス**
   - 探索的データ分析（EDA）
   - 特徴量エンジニアリング
   - モデル選択と評価

2. **機械学習エンジニアリング**
   - モデルの訓練と最適化
   - ハイパーパラメータチューニング
   - 過学習対策

3. **ソフトウェアエンジニアリング**
   - モジュール設計
   - オブジェクト指向プログラミング
   - テスト駆動開発

4. **MLOps**
   - 実験管理
   - モデルのバージョニング
   - 再現性の確保

5. **可視化とレポーティング**
   - データ可視化のベストプラクティス
   - レポート自動生成
   - ストーリーテリング

---

## 📊 成功指標（KPI）

### プロジェクト完成度
- [ ] 全てのPhaseが完了
- [ ] 全てのモジュールにテストが存在
- [ ] ドキュメントが完備
- [ ] デモアプリが動作

### コード品質
- [ ] flake8でエラーなし
- [ ] mypyで型エラーなし
- [ ] テストが全てパス

### 実用性
- [ ] 他の回帰問題に容易に適用可能
- [ ] 設定ファイルで簡単にカスタマイズ可能
- [ ] 第三者が理解・使用できるドキュメント

---

## 🔄 今後の拡張可能性

このプロジェクトをベースに、以下の発展が可能：

### 技術的拡張
1. **他のデータセットへの適用**
   - カリフォルニア住宅価格
   - 独自の不動産データ

2. **高度なモデル**
   - XGBoost, LightGBMとの比較
   - アンサンブル学習
   - ニューラルネットワークのアーキテクチャサーチ

3. **ハイパーパラメータ最適化**
   - Optuna統合
   - ベイズ最適化

4. **モデル解釈性**
   - SHAP値の統合
   - LIME
   - Attention機構の可視化

### プロダクション化
1. **API化**
   - FastAPIでRESTful API構築
   - Docker化
   - Kubernetes デプロイ

2. **モニタリング**
   - モデルのドリフト検出
   - パフォーマンスモニタリング

3. **継続的学習**
   - 新しいデータでの再訓練パイプライン
   - A/Bテスト機能

---

## 📝 メモ

### 実装時の注意点
1. **データの扱い**: Boston Housingデータセットは一部倫理的な問題が指摘されているため、ドキュメントでその点に言及
2. **再現性**: 全ての乱数を制御（PyTorch, NumPy, Python random）
3. **パフォーマンス**: 小規模データセットなのでGPUは不要だが、GPU対応コードとして実装
4. **互換性**: PyTorch 2.0+を前提とするが、下位互換性も考慮

### 参考リソース
- [PyTorch公式チュートリアル](https://pytorch.org/tutorials/)
- [Scikit-learn ドキュメント](https://scikit-learn.org/)
- [Streamlit ドキュメント](https://docs.streamlit.io/)
- [MLOps ベストプラクティス](https://ml-ops.org/)

---

## ✅ チェックリスト

実装完了の確認用チェックリスト：

### コア機能
- [ ] データ前処理パイプライン
- [ ] 複数のモデルアーキテクチャ（最低3つ）
- [ ] 訓練システム（Trainer）
- [ ] 評価システム（Evaluator）
- [ ] 可視化モジュール
- [ ] 実験管理システム

### コード品質
- [ ] 全モジュールにdocstring
- [ ] 全関数にtype hints
- [ ] ユニットテスト（カバレッジ80%+）
- [ ] PEP8準拠
- [ ] ロギング実装

### ドキュメント
- [ ] README.md更新
- [ ] API_REFERENCE.md
- [ ] TUTORIAL.md
- [ ] データ探索ノートブック
- [ ] 結果分析ノートブック

### デモ
- [ ] Streamlitアプリ動作
- [ ] Gradioアプリ動作（オプション）

### 最終確認
- [ ] 第三者が実行可能
- [ ] 全てのテストがパス
- [ ] requirements.txtが正確
- [ ] .gitignoreが適切

---

**作成日**: 2025-11-30
**バージョン**: 1.0
**作成者**: 楊 洋
**ステータス**: 実装前

---

このドキュメントは、プロジェクトの実装が進むにつれて更新されます。
